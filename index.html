<script>
const API_URL = "https://script.google.com/macros/s/AKfycb.../exec"; // 実際のURL

async function loadSheet() {
  try {
    const container = document.getElementById('scrollContainer');
    const scrollLeft = container.scrollLeft;
    const scrollTop = container.scrollTop;

    const res = await fetch(API_URL + `?t=${Date.now()}`, { cache: "no-store" });
    const data = await res.json();
    console.log("取得データ:", data); // ← デバッグ用

    const table = document.getElementById("sheetTable");
    table.innerHTML = "";

    if (!data || data.length === 0) {
      console.warn("データが空です");
      return;
    }

    const headers = Object.keys(data[0]);
    const thead = document.createElement("thead");
    const headerRow = document.createElement("tr");
    headers.forEach(h => {
      const th = document.createElement("th");
      th.textContent = h;
      headerRow.appendChild(th);
    });
    thead.appendChild(headerRow);
    table.appendChild(thead);

    const tbody = document.createElement("tbody");
    data.forEach(row => {
      const tr = document.createElement("tr");
      headers.forEach(h => {
        const td = document.createElement("td");
        td.textContent = row[h] ?? ""; // nullやundefinedを空文字に
        tr.appendChild(td);
      });
      tbody.appendChild(tr);
    });
    table.appendChild(tbody);

    setTimeout(() => {
      container.scrollLeft = scrollLeft;
      container.scrollTop = scrollTop;
    }, 50);

  } catch (err) {
    console.error("APIの読み込みに失敗しました", err);
  }
}

loadSheet();
setInterval(loadSheet, 10000);
</script>
